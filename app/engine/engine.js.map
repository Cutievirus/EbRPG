{"version":3,"sources":["0_pixi_mod.js","1_options.js","1_utility.js","2_main.js","a_mixin_event.js","a_mixin_util.js","cache.js","class_0_ui.js","class_battler.js","class_sprite.js","class_ui_scene.js","class_window.js","input_keyboard.js","input_mouse.js","scene_home.js","scene_map.js","tilemap.js"],"names":["PIXI","DisplayObject","prototype","enabled","enable","this","visible","disable","update","delta","zIndex","Container","children","sort","a","b","child","Object","defineProperty","[object Object]","obj","Filament","Scene","parent","scene","addChild","Texture","crop","x","y","w","h","rect","arguments","length","Rectangle","baseTexture","Sprite","texture","Enum","values","value","SCALE_MODE","settings","width","height","tileSize","cellSize","scaleMode","HYBRID","maintainAspectRatio","uiRes","language","configure","options","assign","loadSettings","async","fetch","gameFile","json","body","document","style","setProperty","defineProperties","pixiScaleMode","get","NORMAL","SCALE_MODES","LINEAR","NEAREST","truncateNumber","n","truncs","Math","floor","LARGE_NUMBER_ABBREVIATIONS","sleep","ms","Promise","resolve","setTimeout","minmax","min","max","val","round","places","func","factor","pow","ceil","arrayAdd","array","index","indexOf","splice","arrayRemove","target","mixins","mixin","field","mixin_object","implement","call","Function","_mixins","push","bind","instance","clazz","untag","s","v","Array","string","i","html","args","div","createElement","innerHTML","NodeList","childNodes","node","append","Element","match","element","id","reg","exec","classList","add","setAttribute","mount","mountElement","handler","construct","isConstructor","f","Boolean","Proxy","err","CoordMap","dimensions","dfault","defaultArgs","data","yz","_getValue","_getSubDimension","set","subdimension","unset","keys","has","pixiCanvas","querySelector","parentElement","ui_container","getElementById","pixi","Application","view","backgroundColor","start","pixiContext","getContext","hybridCanvas","hybridContext","appendChild","opacity","window","addEventListener","resize","ticker","scenes","elapsedMS","updateUI","render","drawImage","roundScale","scaleX","offsetWidth","scaleY","offsetHeight","scale","ratio1","renderer","imageSmoothingEnabled","MixinEvents","events","eventname","create","event","eventlist","getEventList","callback","remove","removeEvent","MixinEventHandler","fireEvent","addListener","eventHandler","MixinUtil","key","Cache","_cache","path","gameAsset","resource","requestJSON","image","requestImage","TileSet","requestAsset","url","reject","AssetLoader","addRequest","cache","loaders","Loader","super","_requests","load","loader","resources","request","error","AssetRequest","UI","ui","anchor","ObservablePoint","_onAnchorUpdate","setAccessor","position","v1","v2","destroy","parentNode","removeChild","name","String","getAttribute","getPropertyValue","attributes","properties","worldVisible","mountUI","Battler","stats","lethality","resilience","haste","spirit","luck","EMPTY","loadTexture","activeScene","home","oldScene","enter","leave","stage","windows","Window","ui_width","ui_height","minwidth","minheight","maxwidth","maxheight","_hasFrame","_interactive","movable","resizable","closable","edgeSnap","content","handle","closeButton","teletype","dragging","finishDrag","contentObserver","MutationObserver","resizing","observe","attributeFilter","interactive","hasFrame","bounds","left","worldTransform","tx","top","ty","getBoundsUI","windex","setProperties","--width","--height","--x","--y","--z","--alpha","worldAlpha","setAttributes","data-frame","data-interactive","data-movable","data-resizable","data-closable","movementX","movementY","text","win","updateDrag","updateResize","keyboard","getKey","code","keygroup","keygroups","keyname","Key","addEventHandler","isDown","KeyGroup","keynames","addKey","mouse","alpha","map","TileMap","MapCellTexture","RenderTexture","tilemap","BaseRenderTexture","MapCellLayer","tileset","stamp","getStamp","MapCell","baseLayer","fringeLayer","loaded","lastTileset","actors","stack","tile","loadTile","tileData","tilesetId","ts","tileX","tileY","requestTileset","tileId","getTile","layer","drawTile","row","undefined","note","passage","opaque","terrain","actorLayer","cells","selector","TileSelector"],"mappings":"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","file":"engine.js","sourcesContent":["PIXI.DisplayObject.prototype.enabled=true;\nPIXI.DisplayObject.prototype.enable=function(){\n\tthis.enabled=true;\n\tthis.visible=true;\n};\nPIXI.DisplayObject.prototype.disable=function(){\n\tthis.enabled=false;\n\tthis.visible=false;\n};\nPIXI.DisplayObject.prototype.update=function(delta){};\n\nPIXI.DisplayObject.prototype.zIndex=0;\nPIXI.Container.prototype.update=function(delta){\n\tthis.children.sort((a,b)=>a.zIndex-b.zIndex);\n\tfor(const child of this.children){\n\t\tchild.update(delta);\n\t}\n};\n\nObject.defineProperty(PIXI.DisplayObject.prototype,'scene',{\n\tget(){\n\t\tlet obj=this;\n\t\twhile (!(obj instanceof Filament.Scene) && obj.parent){\n\t\t\tobj=obj.parent;\n\t\t}\n\t\treturn (obj instanceof Filament.Scene)?obj:null;\n\t},\n\tset(scene){\n\t\tif(this.scene===scene){ return; }\n\t\tscene.addChild(this);\n\t}\n});\n\nPIXI.Texture.prototype.crop=function(x,y,w,h){\n\tconst rect = arguments.length===1?x:new PIXI.Rectangle(x,y,w,h);\n\treturn new PIXI.Texture(this.baseTexture,rect);\n}\n\nPIXI.Sprite.prototype.crop=function(){\n\tthis.texture = this.texture.crop(...arguments);\n}","Filament.Enum = class Enum{\n\tconstructor(...values){\n\t\tfor (const value of values){\n\t\t\tthis[value]=value;\n\t\t}\n\t}\n};\n\nFilament.SCALE_MODE = new Filament.Enum(\n\t\"NORMAL\",\"NEAREST\",\"HYBRID\"\n);\n\nFilament.settings = {\n\twidth: 320,\n\theight: 240,\n\ttileSize: 16,\n\tcellSize: 24,\n\tscaleMode: Filament.SCALE_MODE.HYBRID,\n\tmaintainAspectRatio: true,\n\tuiRes:1,\n\tlanguage:'en',\n};\n\nFilament.configure=options=>{\n\tObject.assign(Filament.settings,options);\n};\n\nFilament.loadSettings=async function(){\n\tconst settings = await (await fetch(Filament.gameFile('settings.json'))).json();\n\tFilament.configure(settings);\n\n\tconst body = document.body.style;\n\tbody.setProperty('--uiRes',Filament.settings.uiRes);\n\tbody.setProperty('--screen-width',Filament.settings.width);\n\tbody.setProperty('--screen-height',Filament.settings.height);\n\tbody.setProperty('--tileSize',Filament.settings.tileSize);\n};\n\nObject.defineProperties(Filament,{\n\tpixiScaleMode:{\n\t\tget:()=>Filament.settings.scaleMode===Filament.SCALE_MODE.NORMAL ? PIXI.SCALE_MODES.LINEAR : PIXI.SCALE_MODES.NEAREST\n\t}\n});","Filament.truncateNumber=n=>{\n\tif(n<=99999){ return n+''; }\n\tlet truncs = 0;\n\twhile (n>9999 && truncs<5){\n\t\tn/=1000;\n\t\t++truncs;\n\t}\n\treturn Math.floor(n)+Filament.LARGE_NUMBER_ABBREVIATIONS[truncs];\n};\nFilament.LARGE_NUMBER_ABBREVIATIONS=[\n\t'','K','M','B','T','Q'\n];\nFilament.sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));\n\nFilament.minmax=(min,max,val)=>Math.max(min,Math.min(max,val));\n\nFilament.round=(value,places=0,func='round')=>{\n\tconst factor = Math.pow(10,places);\n\treturn Math[func](value*factor)/factor\n}\nFilament.floor=(value,places)=>Filament.round(value,places,'floor');\nFilament.ceil=(value,places)=>Filament.round(value,places,'ceil');\n\nFilament.arrayAdd=(array,obj,index=array.length)=>{\n\tif(array.indexOf(obj)>=0){ return true; }\n\tarray.splice(index,0,obj);\n\treturn false;\n}\n\nFilament.arrayRemove=(array,obj)=>{\n\tconst index=array.indexOf(obj);\n\tif(index>=0){\n\t\tarray.splice(index,1);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n/**\n * Like Object.assign, except doesn't overwrite fields\n * that already exist.\n */ \nFilament.assign=(target,...mixins)=>{\n\tfor (const mixin of mixins) for (const field in mixin){\n\t\tif(!(field in target)){\n\t\t\ttarget[field] = mixin[field];\n\t\t}\n\t}\n}\n\nFilament.mixin_object=(target,mixin)=>{\n\tFilament.assign(target,mixin);\n\tif(typeof mixin.implement === 'function'){ mixin.implement.call(target); }\n}\n\nFilament.mixin=(target,mixin)=>{\n\tif (!(target instanceof Function)){ return Filament.mixin_object(target,mixin); }\n\tif(!target._mixins){ target._mixins=[] }\n\ttarget._mixins.push(mixin);\n\tFilament.assign(target.prototype,mixin);\n\ttarget.prototype.implement=Filament.implement.bind(this);\n}\nFilament.implement=function(instance,clazz){\n\tif (!instance || !clazz._mixins){ return; }\n\tfor (const mixin of clazz._mixins){\n\t\tif(typeof mixin.implement === 'function'){ mixin.implement.call(instance); }\n\t}\n}\n\nFilament.untag=(s,...v)=>{\n\tif(!(s instanceof Array)){ return s; }\n\tlet string = '';\n\tfor (const i in s){ string+=s[i]+(v[i]||''); }\n\treturn string;\n}\n\nFilament.html=(...args)=>{\n\tconst string = Filament.untag(...args);\n\tconst div = document.createElement('div');\n\tdiv.innerHTML=string;\n\treturn new Filament.NodeList(...div.childNodes);\n}\n\nFilament.NodeList=class extends Array{\n\tmount(target){\n\t\tfor (const node of this){\n\t\t\ttarget.append(node);\n\t\t}\n\t\treturn this;\n\t}\n\telements(){\n\t\tlet array = [];\n\t\tfor (const node of this){\n\t\t\tif(node instanceof Element){ array.push(node); }\n\t\t}\n\t\treturn array;\n\t}\n}\n\nFilament.createElement=(string,child)=>{\n\tlet match = string.match(/^[^\\s.#[\\]]+/);\n\tif(!match){throw `Couldn't find tagname in string ${string}`;}\n\tconst element = document.createElement(match[0]);\n\tmatch=string.match(/#([^\\s.#[\\]]+)/);\n\tif(match){ element.id=match[1]; }\n\tlet reg=/\\.([^\\s.#[\\]]+)/g;\n\twhile(match=reg.exec(string)){\n\t\telement.classList.add(match[1]);\n\t}\n\treg=/\\[([^\\s.#[\\]=]+)=([^\\s.#[\\]=]+)\\]/g;\n\twhile(match=reg.exec(string)){\n\t\telement.setAttribute(match[1],match[2]);\n\t}\n\tif(child){ element.append(child); }\n\telement.mount=Filament.mountElement;\n\treturn element;\n}\n\nFilament.mountElement=function(target){\n\tif(!(this instanceof Element)){ return; }\n\ttarget.append(this);\n\treturn this;\n};\n\n{\n\tconst handler = {construct(){return handler;}};\n\tFilament.isConstructor=f=>{\n\t\ttry{\n\t\t\treturn Boolean(new (new Proxy(f,handler)));\n\t\t}catch(err){\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\nFilament.CoordMap = class{\n\tconstructor(dimensions=2,dfault=null,...defaultArgs){\n\t\tthis.dimensions=dimensions;\n\t\tthis.dfault=dfault;\n\t\tthis.defaultArgs=defaultArgs;\n\t\tthis.data={};\n\t}\n\tget(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\treturn this._getValue(x);\n\t\t}\n\t\treturn this._getSubDimension(x).get(...yz);\n\t}\n\t_getValue(x){\n\t\tif(x in this.data){\n\t\t\treturn this.data[x];\n\t\t}\n\t\tif(typeof this.dfault==='function'){\n\t\t\tif(Filament.isConstructor(this.dfault)){\n\t\t\t\treturn new this.dfault(...this.defaultArgs);\n\t\t\t}else{\n\t\t\t\treturn this.dfault(...this.defaultArgs);\n\t\t\t}\n\t\t}else{\n\t\t\treturn this.dfault;\n\t\t}\n\t}\n\t_getSubDimension(x){\n\t\tif( !(this.data[x] instanceof Filament.CoordMap) ){\n\t\t\tthis.data[x]=new Filament.CoordMap(this.dimensions-1,this.dfault,...this.defaultArgs);\n\t\t}\n\t\treturn this.data[x];\n\t}\n\tset(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\tthis.data[x]=yz[0];\n\t\t\treturn;\n\t\t}\n\t\tthis._getSubDimension(x).set(...yz);\n\t}\n\tunset(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\tdelete this.data[x];\n\t\t\treturn;\n\t\t}\n\t\tconst subdimension = this._getSubDimension(x);\n\t\tsubdimension.unset(...yz);\n\t\tif(Object.keys(subdimension.data).length===0){\n\t\t\tdelete this.data[x];\n\t\t}\n\t}\n\thas(x,...yz){\n\t\tif(this.dimensions<=1){\n\t\t\treturn x in this.data;\n\t\t}\n\t\tif( !(x in this.data) ){ return false;}\n\t\treturn this._getSubDimension(x).has(...yz);\n\t}\n}\n","Filament.pixiCanvas = document.querySelector(\"#screen-game canvas\");\nFilament.parent = Filament.pixiCanvas.parentElement;\nFilament.ui_container = document.getElementById(\"ui-container\");\nFilament.pixi = new PIXI.Application({\n\tview: Filament.pixiCanvas,\n\twidth: Filament.settings.width,\n\theight: Filament.settings.height,\n\tbackgroundColor:0x000088\n});\n\nFilament.start=async function(){\n\tawait Filament.loadSettings();\n\tFilament.pixiContext = Filament.pixiCanvas.getContext(\"2d\");\n\tif( Filament.settings.scaleMode === Filament.SCALE_MODE.HYBRID ){\n\t\tFilament.hybridCanvas = document.createElement('canvas');\n\t\tFilament.hybridContext = Filament.hybridCanvas.getContext(\"2d\");\n\t\tFilament.hybridCanvas.id=\"hybrid-canvas\";\n\t\tFilament.pixiCanvas.parentElement.appendChild(Filament.hybridCanvas);\n\t\tFilament.pixiCanvas.style.opacity=0;\n\t}\n\n\tFilament.ui_container.style.width = Filament.settings.width*Filament.settings.uiRes+\"px\";\n\tFilament.ui_container.style.height = Filament.settings.height*Filament.settings.uiRes+\"px\";\n\n\twindow.addEventListener('resize',Filament.resize);\n\tFilament.resize();\n\tFilament.ticker = Filament.pixi.ticker.add(Filament.update,Filament);\n\n\tfor (const scene of Object.values(Filament.scenes)){\n\t\tscene.start();\n\t}\n};\n\nFilament.update=()=>{\n\tconst delta = Filament.ticker.elapsedMS/1000;\n\n\tif(Filament.scene){\n\t\tFilament.scene.update(delta);\n\t\tFilament.scene.updateUI(delta);\n\t}\n\n\tif(Filament.hybridCanvas){\n\t\tFilament.pixi.render();\n\t\tFilament.hybridContext.drawImage(\n\t\t\tFilament.pixiCanvas,\n\t\t\t0,0, Filament.settings.width, Filament.settings.height,\n\t\t\t0,0, Filament.hybridCanvas.width, Filament.hybridCanvas.height\n\t\t);\n\t}\n};\n\nFilament.roundScale=n=>Math.round(n)||1;\n\nFilament.resize=()=>{\n\tlet scaleX = Filament.parent.offsetWidth / Filament.settings.width;\n\tlet scaleY = Filament.parent.offsetHeight / Filament.settings.height;\n\tlet scale = Math.min(scaleX,scaleY);\n\tif(Filament.settings.maintainAspectRatio){\n\t\tscaleX = scaleY = scale;\n\t}else{\n\t\tlet ratio1 = Filament.parent.offsetWidth/Filament.parent.offsetHeight;\n\t\tlet ratio2 = Filament.settings.width/Filament.settings.height;\n\t\tif(ratio1>ratio2){//wide\n\t\t\tFilament.pixi.renderer.resize(\n\t\t\t\tFilament.settings.height*ratio1,\n\t\t\t\tFilament.settings.height\n\t\t\t);\n\t\t}else{ //tall\n\t\t\tFilament.pixi.renderer.resize(\n\t\t\t\tFilament.settings.width,\n\t\t\t\tFilament.settings.width/ratio1\n\t\t\t);\n\t\t}\n\t\t\n\t}\n\tFilament.scaleX=scaleX;\n\tFilament.scaleY=scaleY;\n\tFilament.scale=scale;\n\t\n\tFilament.pixiCanvas.style.width = Filament.settings.width*scaleX+\"px\";\n\tFilament.pixiCanvas.style.height = Filament.settings.height*scaleY+\"px\";\n\tif(Filament.hybridCanvas){\n\t\tFilament.hybridCanvas.width = Filament.settings.width*Filament.roundScale(scaleX);\n\t\tFilament.hybridCanvas.height = Filament.settings.height*Filament.roundScale(scaleY);\n\t\tFilament.hybridCanvas.style.width = Filament.pixiCanvas.style.width;\n\t\tFilament.hybridCanvas.style.height = Filament.pixiCanvas.style.height;\n\t\tFilament.hybridContext.imageSmoothingEnabled=false;\n\t}\n\tFilament.ui_container.style.setProperty('--scale',\n\t\tscale/Filament.settings.uiRes);\n\tFilament.ui_container.style.setProperty('--left',\n\t\tFilament.parent.offsetWidth/2 - Filament.ui_container.offsetWidth/2);\n\tFilament.ui_container.style.setProperty('--top',\n\t\tFilament.parent.offsetHeight/2 - Filament.ui_container.offsetHeight/2);\n};","Filament.MixinEvents={\n\timplement(){\n\t\tthis.events={};\n\t},\n\tgetEventList(eventname,create){\n\t\tif(!(eventname in this.events) && create){\n\t\t\tthis.events[eventname]=[];\n\t\t}\n\t\treturn this.events[eventname];\n\t},\n\tfireEvent(eventname,event={}){\n\t\tconst eventlist=this.getEventList(eventname,false);\n\t\tif(!eventlist){ return; }\n\t\tfor (const callback of eventlist){\n\t\t\tevent.remove=Filament.MixinEvents.removeEvent.bind(this,eventname,callback);\n\t\t\tif(typeof callback === 'function'){ callback(event); }\n\t\t}\n\t\t\n\t},\n\taddEvent(eventname,callback){\n\t\treturn Filament.arrayAdd(this.getEventList(eventname,true),callback);\n\t},\n\tremoveEvent(eventname,callback){\n\t\tconst eventlist = this.getEventList(eventname,false);\n\t\tif(!eventlist){ return false; }\n\t\treturn Filament.arrayRemove(this.events[eventname],callback);\n\t}\n}\n\nFilament.MixinEventHandler={\n\teventHandler(eventname,event){\n\t\tif(typeof this.fireEvent==='function'){\n\t\t\tthis.fireEvent(eventname,event);\n\t\t}\n\n\t},\n\taddEventHandler(eventname,addListener=true){\n\t\tconst handler = `${eventname}Handler`;\n\t\tthis[handler]=this.eventHandler.bind(this,eventname);\n\t\tif(addListener){\n\t\t\tFilament.parent.addEventListener(eventname,this[handler]);\n\t\t}\n\t},\n}","Filament.MixinUtil={\r\n\tmount(parent){\r\n\t\tparent.addChild(this);\r\n\t\treturn this;\r\n    },\r\n    assign(key,value){\r\n        if(typeof arguments[0]===\"object\"){\r\n            Object.assign(this,arguments[0]);\r\n        }else{\r\n            this[key]=value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\nFilament.mixin(PIXI.DisplayObject, Filament.MixinUtil);","Filament.Cache=class{\n\tconstructor(){\n\t\tthis._cache={};\n\t}\n\n\tasync requestImage(key,path='assets/images'){\n\t\treturn await this.gameAsset(key,path,(resource)=>{\n\t\t\tresource.texture.baseTexture.scaleMode=Filament.pixiScaleMode;\n\t\t\treturn resource.texture;\n\t\t});\n\t}\n\tasync requestAudio(key){\n\t\t\n\t}\n\tasync requestJSON(key,path='data'){\n\t\treturn await this.gameAsset(key,path,(resource)=>{\n\t\t\treturn resource.data;\n\t\t})\n\t}\n\tasync requestTileset(id){\n\t\tconst data = await requestJSON(`tilesets/${id}.json`);\n\t\tconst image = await requestImage(data.image,'assets/tilesets');\n\t\treturn new Filament.TileSet(image,data);\n\t}\n\tasync gameAsset(key,path,callback){\n\t\tpath=Filament.path(path,key);\n\t\treturn await this.requestAsset(path,Filament.gameFile(path),callback);\n\t}\n\trequestAsset(key,url,callback){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tif(!this._cache[key]){\n\t\t\t\tthis._cache[key]=new Filament.AssetLoader(key,url,this);\n\t\t\t}\n\t\t\tif(this._cache[key] instanceof Filament.AssetLoader){\n\t\t\t\tthis._cache[key].addRequest(resolve,reject,callback);\n\t\t\t}else{\n\t\t\t\tresolve(callback(this._cache[key]));\n\t\t\t}\n\t\t});\n\t}\n}\nFilament.cache=new Filament.Cache();\n\nFilament.AssetLoader=class extends PIXI.loaders.Loader{\n\tconstructor(key,url,cache){\n\t\tsuper();\n\t\tthis.add(key,url);\n\t\tthis._requests=[];\n\t\tthis.load((loader,resources)=>{\n\t\t\tconst resource=resources[key];\n\t\t\tfor (const request of this._requests){\n\t\t\t\tif(resource.error){\n\t\t\t\t\trequest.reject(resource.error);\n\t\t\t\t}else{\n\t\t\t\t\trequest.resolve(request.callback(resource));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(resource.error){\n\t\t\t\tdelete cache._cache[key];\n\t\t\t}else{\n\t\t\t\tcache._cache[key]=resource;\n\t\t\t}\n\t\t});\n\t}\n\taddRequest(resolve,reject,callback){\n\t\tthis._requests.push(new Filament.AssetRequest(resolve,reject,callback));\n\t}\n}\n\nFilament.AssetRequest=class{\n\tconstructor(resolve,reject,callback){\n\t\tthis.resolve=resolve;\n\t\tthis.reject=reject;\n\t\tthis.callback=callback;\n\t}\n}","Filament.UI = class extends PIXI.Container{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.ui = document.createElement('div');\n\t\tthis.anchor = new PIXI.ObservablePoint(this._onAnchorUpdate, this);\n\t\tthis.setAccessor('id');\n\t\tthis.setAccessor('className');\n\t\tthis.classList=this.ui.classList;\n\t\tthis.style=this.ui.style;\n\t\tthis.style.position=\"absolute\";\n\t}\n\tmount(parent){\n\t\tparent.addChild(this);\n\t\treturn this;\n\t}\n\tmountUI(parent){\n\t\t(parent instanceof Filament.UI ? parent.ui : parent).append(this.ui);\n\t\treturn this;\n\t}\n\tsetAccessor(v1,v2=v1){\n\t\tObject.defineProperty(this,v1,{\n\t\t\tget(){return this.ui[v2];},\n\t\t\tset(v){this.ui[v2]=v;}\n\t\t});\n\t}\n\tenable(){\n\t\tsuper.enable();\n\t\tthis.setAttribute('data-enabled',true);\n\t}\n\tdisable(){\n\t\tsuper.disable();\n\t\tthis.setAttribute('data-enabled',false);\n\t}\n\tdestroy(){\n\t\tsuper.destroy();\n\t\tthis.ui.parentNode.removeChild(this.ui);\n\t}\n\tsetAttribute(name,value){\n\t\tvalue=String(value);\n\t\tif(this.ui.getAttribute(name)!==value){\n\t\t\tthis.ui.setAttribute(name,value);\n\t\t}\n\t}\n\tsetProperty(name,value){\n\t\tvalue=String(value);\n\t\tif(this.ui.style.getPropertyValue(name)!==value){\n\t\t\tthis.ui.style.setProperty(name,value);\n\t\t}\n\t}\n\tsetAttributes(attributes){\n\t\tfor (const key in attributes){ this.setAttribute(key,attributes[key]); }\n\t}\n\tsetProperties(properties){\n\t\tfor (const key in properties){ this.setProperty(key,properties[key]); }\n\t}\n\tupdateUI(delta){\n\t\tthis.setAttribute(\"data-visible\",this.worldVisible);\n\t\tif(!this.ui.parentNode && this.scene && this.scene!==this){ this.mountUI(this.scene); }\n\t}\n\t_onAnchorUpdate(){\n\t\t//this.ui.style.transform = \"translate(\"+-this.anchor.x*100+\"%,\"+-this.anchor.y*100+\"%)\";\n\t}\n}","/* NOTES\nLethality (attack power)\nResilience (hp and def)\nHaste (SP)\nSpirit (MP)\n\nhidden stats:\nLuck\n\n\nEquipment types:\nWeapon\nArmor\nAccessory\n*/\n\nFilament.Battler = class{\n\tconstructor(){\n\t\tthis.stats={\n\t\t\tlethality:0,\n\t\t\tresilience:0,\n\t\t\thaste:0,\n\t\t\tspirit:0,\n\t\t\tluck:0,\n\t\t};\n\t}\n};","Filament.Sprite = class extends PIXI.Sprite{\n\tconstructor(key){\n\t\tsuper(PIXI.Texture.EMPTY);\n\t\tthis.loadTexture(key);\n\t}\n\tasync loadTexture(key){\n\t\tthis.texture=await Filament.cache.requestImage(key);\n\t}\n}","Filament.scenes={};\nFilament.activeScene=\"home\";\nObject.defineProperty(Filament,\"scene\",{\n\tget:()=>Filament.scenes[Filament.activeScene]||Filament.scenes.home,\n\tset(value){\n\t\tconst oldScene=Filament.activeScene;\n\t\tif(value in Filament.scenes){\n\t\t\tFilament.activeScene=value;\n\t\t}else{\n\t\t\tfor (const key in Filament.scenes){\n\t\t\t\tif(value===Filament.scenes[key]){\n\t\t\t\t\tFilament.activeScene=key;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(Filament.activeScene===oldScene){ return; }\n\t\tfor (const key in Filament.scenes){\n\t\t\tconst scene = Filament.scenes[key];\n\t\t\tif(Filament.activeScene===scene.name){\n\t\t\t\tscene.enable();\n\t\t\t\tscene.enter();\n\t\t\t}else if (scene.enabled){\n\t\t\t\tscene.disable();\n\t\t\t\tscene.leave();\n\t\t\t}\n\t\t}\n\t}\n})\n\nFilament.ui_container = document.getElementById(\"ui-container\");\n\nFilament.Scene = class extends Filament.UI{\n\tconstructor(name){\n\t\tsuper();\n\t\tthis.mountUI(Filament.ui_container);\n\t\tthis.mount(Filament.pixi.stage);\n\t\tFilament.scenes[name] = this;\n\t\tthis.id=\"scene-\"+name;\n\t\tthis.classList.add(\"scene\");\n\t\tthis.name=name;\n\t\tthis.windows=[];\n\t\tthis.setAttribute('data-visible',false);\n\t}\n\tenable(){\n\t\tsuper.enable();\n\t\tthis.setAttribute('data-visible',true);\n\t}\n\tdisable(){\n\t\tsuper.disable();\n\t\tthis.setAttribute('data-visible',false);\n\t}\n\tupdateUI(delta){\n\t\tsuper.updateUI(delta);\n\t\tfor (let i=this.windows.length-1; i>=0; --i){\n\t\t\tthis.windows[i].updateUI(delta);\n\t\t}\n\t}\n\tstart(){}\n\tenter(){}\n\tleave(){}\n}","Filament.Window = class extends Filament.UI{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.classList.add('window');\n\t\tthis.ui_width=20;\n\t\tthis.ui_height=20;\n\t\tthis.minwidth=20;\n\t\tthis.minheight=20;\n\t\tthis.maxwidth=Filament.settings.width;\n\t\tthis.maxheight=Filament.settings.height;\n\t\tthis._hasFrame=false;\n\t\tthis._interactive=false;\n\t\tthis.movable=false;\n\t\tthis.resizable=false;\n\t\tthis.closable=false;\n\t\tthis.edgeSnap=true;\n\t\tthis.content=Filament.createElement('div.content').mount(this.ui);\n\t\tthis.handle=Filament.createElement('div.handle').mount(this.ui);\n\t\tthis.closeButton=Filament.createElement('div.closeButton','×').mount(this.ui);\n\t\tthis.closeButton.addEventListener('click',event=>{\n\t\t\tthis.destroy();\n\t\t});\n\t\tthis.teletype=0;\n\t\tthis.handle.addEventListener('mousedown',event=>{\n\t\t\tFilament.arrayRemove(this.scene.windows,this);\n\t\t\tFilament.arrayAdd(this.scene.windows,this);\n\t\t\tthis.dragging=true;\n\t\t});\n\t\tthis.handle.addEventListener('mouseup',event=>{\n\t\t\tthis.dragging=false;\n\t\t\tthis.finishDrag(event);\n\t\t});\n\t\tthis.contentObserver=new MutationObserver(()=>{\n\t\t\tif(this.resizable){\n\t\t\t\tif(this.content.style.width||this.content.style.height){\n\t\t\t\t\tthis.content.style.width='';\n\t\t\t\t\tthis.content.style.height='';\n\t\t\t\t\tthis.resizing=true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.contentObserver.observe(this.content,{attributes:true,attributeFilter:['style']});\n\t}\n\tmount(parent){\n\t\tsuper.mount(parent);\n\t\tif(parent.scene)this.mountUI(this.scene);\n\t\treturn this;\n\t}\n\tmountUI(scene){\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\n\t\tsuper.mountUI(scene);\n\t\tFilament.arrayAdd(scene.windows,this);\n\t\treturn this;\n\t}\n\tdestroy(){\n\t\tif(this.scene) Filament.arrayRemove(this.scene.windows,this);\n\t\tsuper.destroy(...arguments);\n\t}\n\tget width(){return this.ui_width;}\n\tset width(v){this.ui_width=v;}\n\tget height(){return this.ui_height;}\n\tset height(v){this.ui_height=v;}\n\tget interactive(){return this._interactive||this.movable||this.resizable||this.closable;}\n\tset interactive(v){this._interactive=v;}\n\tget hasFrame(){return this._hasFrame||this.movable||this.resizable||this.closable;}\n\tset hasFrame(v){this._hasFrame=v;}\n\tgetBoundsUI(){\n\t\tlet bounds = {};\n\t\tbounds.width = Filament.round(this.width,2);\n\t\tbounds.height = Filament.round(this.height,2);\n\t\tbounds.left=Filament.round(this.worldTransform.tx-this.anchor.x*bounds.width,2);\n\t\tbounds.top=Filament.round(this.worldTransform.ty-this.anchor.y*bounds.height,2);\n\t\tif(this.edgeSnap){\n\t\t\tbounds.left=Filament.minmax(0,Filament.settings.width-bounds.width,bounds.left);\n\t\t\tbounds.top=Filament.minmax(0,Filament.settings.height-bounds.height,bounds.top);\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateUI(delta){\n\t\tsuper.updateUI(delta);\n\t\tif(this.resizable){\n\t\t\tthis.width=Filament.minmax(this.minwidth,this.maxwidth,this.width);\n\t\t\tthis.height=Filament.minmax(this.minheight,this.maxheight,this.height);\n\t\t}\n\t\tlet bounds = this.getBoundsUI(true);\n\t\tconst windex = this.scene.windows.indexOf(this);\n\t\tthis.setProperties({\n\t\t\t\"--width\"\t:\tbounds.width,\n\t\t\t\"--height\"\t:\tbounds.height,\n\t\t\t\"--x\"\t\t:\tbounds.left,\n\t\t\t\"--y\"\t\t:\tbounds.top,\n\t\t\t\"--z\"\t\t:\tthis.zIndex+windex/1000,\n\t\t\t\"--alpha\"\t:\tthis.worldAlpha,\n\t\t});\n\t\tthis.setAttributes({\n\t\t\t\"data-frame\"\t\t:\tthis.hasFrame,\n\t\t\t\"data-interactive\"\t:\tthis.interactive,\n\t\t\t\"data-movable\"\t\t:\tthis.movable,\n\t\t\t\"data-resizable\"\t:\tthis.resizable,\n\t\t\t\"data-closable\"\t\t:\tthis.closable,\n\t\t});\n\t}\n\tupdateDrag(event){\n\t\tthis.x+=event.movementX/Filament.scale;\n\t\tthis.y+=event.movementY/Filament.scale;\n\t}\n\tfinishDrag(event){\n\t\tif(this.edgeSnap){\n\t\t\tthis.x=Filament.minmax(0,Filament.settings.width-this.width,this.x);\n\t\t\tthis.y=Filament.minmax(0,Filament.settings.height-this.height,this.y);\n\t\t}\n\t}\n\tupdateResize(event){\n\t\tthis.width=Math.min(Filament.settings.width-this.x, this.width+event.movementX/Filament.scale);\n\t\tthis.height=Math.min(Filament.settings.height-this.y, this.height+event.movementY/Filament.scale);\n\t\tthis.resizing=false;\n\t}\n\n\tget text(){ return this.content.innerHTML; }\n\tset text(value){\n\n\t}\n}\n\nwindow.addEventListener('mousemove',event=>{\n\tif(!Filament.scene){ return; }\n\tfor (const win of Filament.scene.windows){\n\t\tif (win.dragging){ win.updateDrag(event); }\n\t\tif (win.resizing){ win.updateResize(event); }\n\t}\n});\nwindow.addEventListener('mouseup',event=>{\n\tif(!Filament.scene){ return; }\n\tfor (const win of Filament.scene.windows){\n\t\twin.dragging=false;\n\t\twin.finishDrag();\n\t}\n});","Filament.keyboard={\n\tkeys:{},\n\teventHandler(eventname,event){\n\t\tconst key = this.getKey(event.code,false);\n\t\tif(!key){ return; }\n\t\tif(typeof key[eventname] === 'function')key[eventname]();\n\t\tfor (const keygroup of key.keygroups){\n\t\t\tkeygroup.fireEvent(eventname,event);\n\t\t}\n\t},\n\tgetKey(keyname,create){\n\t\tif(!(keyname in this.keys) && create){\n\t\t\tthis.keys[keyname]=new Filament.Key(keyname);\n\t\t}\n\t\treturn this.keys[keyname];\n\t}\n};\nFilament.mixin_object(Filament.keyboard,Filament.MixinEventHandler);\nFilament.keyboard.addEventHandler('keydown');\nFilament.keyboard.addEventHandler('keyup');\n\nFilament.Key = class{\n\tconstructor(name){\n\t\tthis.name=name;\n\t\tthis.isDown=false;\n\t\tthis.keygroups=[];\n\t}\n\tkeydown(){\n\t\tthis.isDown=true;\n\t}\n\tkeyup(){\n\t\tthis.isDown=false;\n\t}\n}\n\nFilament.keys={};\nFilament.KeyGroup = class{\n\tconstructor(name,keynames=[]){\n\t\tthis.name=name;\n\t\tFilament.keys[name]=this;\n\t\tthis.keys=[];\n\t\tfor (const keyname of keynames){\n\t\t\tthis.addKey(keyname);\n\t\t}\n\t\t//Filament.mixin(this,Filament.EventMixin);\n\t\tthis.implement(this,Filament.KeyGroup);\n\t}\n\taddKey(keyname){\n\t\tconst key = Filament.keyboard.getKey(keyname,true);\n\t\tFilament.arrayAdd(key.keygroups,this);\n\t\tFilament.arrayAdd(this.keys,key);\n\t}\n\tremoveKey(keyname){\n\t\tconst key = Filament.keyboard.getKey(keyname,false);\n\t\tif(!key){ return; }\n\t\tFilament.arrayRemove(key.keygroups,this);\n\t\tFilament.arrayRemove(this.keys,key);\n\t}\n\tget isDown(){\n\t\tfor (const key in this.keys){\n\t\t\tif(key.isDown){ return true; }\n\t\t}\n\t\treturn false;\n\t}\n}\nFilament.mixin(Filament.KeyGroup, Filament.MixinEvents);\n\nnew Filament.KeyGroup('CONFIRM',['Enter','Space']);\nnew Filament.KeyGroup('CANCEL',['Escape']);\nnew Filament.KeyGroup('UP',['ArrowUp','KeyW']);\nnew Filament.KeyGroup('LEFT',['ArrowLeft','KeyA']);\nnew Filament.KeyGroup('DOWN',['ArrowDown','KeyS']);\nnew Filament.KeyGroup('RIGHT',['ArrowRight','KeyD']);","Filament.mouse={}\r\nFilament.mixin_object(Filament.mouse,Filament.MixinEvents);\r\nFilament.mixin_object(Filament.mouse,Filament.MixinEventHandler);\r\n\r\nFilament.mouse.addEventHandler('click');\r\nFilament.mouse.addEventHandler('dblclick');\r\nFilament.mouse.addEventHandler('mousedown');\r\nFilament.mouse.addEventHandler('mouseup');\r\nFilament.mouse.addEventHandler('mousemove');","new Filament.Scene('home');\n\nFilament.scenes.home.start=function(){\n\tthis.window = new Filament.Window().mount(this);\n\tthis.window.width=100;\n\tthis.window.height=50;\n\tthis.window.x=50;\n\tthis.window.y=75;\n\tthis.window.resizable=true;\n\tthis.window.movable=true;\n\tthis.window.closable=true;\n\tthis.window.content.innerHTML=`Welcome to Filament!<br>\n\t<a href=\"javascript:void(Filament.scene='map');\">Map</a>`;\n\tnew Filament.Sprite('ebby.png').mount(this).assign({alpha:0.6});\n\tnew Filament.Sprite('ebby.png').mount(this).assign({x:20});\n}\n\nFilament.scenes.home.update=function(){\n\t\n}","new Filament.Scene('map');\n\nFilament.scenes.map.start=function(){\n\tFilament.map = new Filament.TileMap().mount(this);\n}\n\nFilament.scenes.map.update=function(){\n\t\n}","\nFilament.MapCellTexture = class extends PIXI.RenderTexture{\n\tconstructor(tilemap){\n\t\tsuper(new PIXI.BaseRenderTexture({\n\t\t\twidth: Filament.settings.tileSize*tilemap.cellSize,\n\t\t\theight: Filament.settings.tileSize*tilemap.cellSize,\n\t\t\tscaleMode: Filament.pixiScaleMode,\n\t\t}));\n\t\tthis.tilemap=tilemap;\n\t}\n};\n\nFilament.MapCellLayer = class extends PIXI.Sprite{\n\tconstructor(tilemap){\n\t\tsuper(new Filament.MapCellTexture(tilemap));\n\t}\n\tdestroy(){\n\t\tsuper.destroy(...arguments);\n\t\tthis.texture.destroy();\n\t}\n\tdrawTile(tileset,tx,ty,x,y){\n\t\tconst stamp = tileset.getStamp(tx,ty);\n\t\tstamp.position.set(x,y);\n\t\tFilament.pixi.renderer.render(stamp,this.texture);\n\t}\n}\n\n/**\n * An object representing an indivitual cell in the tilemap.\n * contains a reference to MapCellLayer objects for the base and fringe layers as well as\n * a list of all entities in the actorLayer associated with this cell.\n */\nFilament.MapCell = class{\n\tconstructor(tilemap){\n\t\tthis.tilemap=tilemap;\n\t\tthis.baseLayer=new Filament.MapCellLayer();\n\t\tthis.fringeLayer=new Filament.MapCellLayer();\n\t\ttilemap.baseLayer.addChild(this.baseLayer);\n\t\ttilemap.fringeLayer.addChild(this.fringeLayer);\n\t\tthis.loaded=false;\n\t\tthis.lastTileset=0;\n\t\tthis.texture = new MapCellTexture(this.tilemap);\n\t}\n\tasync load(){\n\t\t// load cell terrain and json\n\t\tthis.data=[];\n\t\tthis.actors=[];\n\n\t\t// loop through each tile stack in the data\n\t\tfor(let i=0;i<data.length;++i){\n\t\t\tconst stack = data[i];\n\t\t\tconst x=i%this.tilemap.cellSize;\n\t\t\tconst y=Math.floor(i/Math.tilemap.cellSize);\n\t\t\tif(stack instanceof Array){\n\t\t\t\tfor(const tile of stack){ await this.loadTile(tile,x,y); }\n\t\t\t}else{\n\t\t\t\tawait this.loadTile(stack,x,y);\n\t\t\t}\n\t\t}\n\t\tthis.loaded=true;\n\t}\n\tasync loadTile(tileData,x,y){\n\t\tconst tilesetId='ts' in tileData ? tileData.ts : this.lastTileset;\n\t\tif(tilesetId !== this.lastTileset){ this.lastTileset = tilesetId; }\n\t\tconst tileX=tileData.x;\n\t\tconst tileY=tileData.y;\n\t\tconst tileset=Filament.cache.requestTileset(tileId);\n\t\t// get tile layer data so we know how to draw it.\n\t\tconst layerType = tileset.getTile(tileX,tileY).layer;\n\t\tswitch(layerType){\n\t\tcase 0://base\n\t\t\tthis.baseLayer.drawTile(tileset,tileX,tileY,x,y);\n\t\t\tbreak;\n\t\tcase 1://actor\n\t\t\tbreak;\n\t\tcase 2://fringe\n\t\t\tbreak;\n\t\tcase 3://overpass\n\t\t\tbreak;\n\t\tdefault:\n\t\t}\n\t}\n\tunload(){\n\t\tthis.baseLayer.destroy();\n\t\tthis.fringeLayer.destroy();\n\t}\n}\n\nFilament.TileSet = class{\n\tconstructor(image,data){\n\t\tthis.image=image;\n\t\tthis.data=data;\n\t\tthis.stamp = new PIXI.Sprite(image);\n\t}\n\tgetStamp(x,y){\n\t\tconst ts=this.data.tileSize;\n\t\tthis.stamp.crop(x*ts,y*ts,ts,ts);\n\t\treturn this.stamp;\n\t}\n\tgetTile(x,y){\n\t\tconst row = this.data.data[y];\n\t\tif(!row){ return null; }\n\t\tlet tile = row[x];\n\t\tif(tile==undefined){ return null; }\n\t\tif( typeof tile==='number' ){\n\t\t\ttile={data:tile,note:''};\n\t\t}else if( tile.passage ){ return tile; }\n\t\ttile.passage = tile.data & 0b1111;\n\t\ttile.opaque = (tile.data>>>4) & 0b1;\n\t\ttile.layer = (tile.data>>>5) & 0b111;\n\t\ttile.terrain = tile.data>>>8;\n\t\trow[x]=tile;\n\t}\n}\n\n/**\n * The TileMap Class.\n * Each tilemap has multiple elevation layers.\n */\nFilament.TileMap = class extends PIXI.Container{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.baseLayer = new PIXI.Container();\n\t\tthis.actorLayer = new PIXI.Container();\n\t\tthis.fringeLayer = new PIXI.Container();\n\t\tthis.cells = new Filament.CoordMap(2);\n\t\t// TODO: read map settings from JSON.\n\t\tthis.selector = new Filament.TileSelector().mount(this);\n\t\tthis.settings={\n\t\t\tname:'',\n\t\t\tcellSize:null,\n\t\t};\n\t}\n\tget cellSize(){\n\t\treturn this.settings.cellSize?this.settings.cellSize:Filament.settings.cellSize;\n\t}\n\tmount(){\n\t\tsuper.mount(...arguments);\n\t\tthis.selector.mountUI(this.scene);\n\t}\n}\n\n/*\nBetter idea for elevation.\nEverything is handled in one layer with tile stacks as usual.\n\nAn tile can be opaque or transparent.\nOpaque tiles erase underlying tiles when placed.\nTransparent tiles stack on top of underlying tiles.\n\nThere are four \"layering\" options for each tile.\nBase is rendered under player.\nActor is rendered same layer as player.\nFringe is rendered above player.\nOverpass is special. It's in the actor layer, but is rendered above or below the player depending on their elevation.\noverpass elevation is one plus the number of overpass tiles underlying in the stack.\nWhen player can step onto overpass tile, their elevation is set to same as the overpass they're walking on.\nWhen player can't step onto the overpass tile, they instead step under it.\n\n*/\n\nFilament.TileSelector = class extends Filament.UI{\n\tconstructor(){\n\t\tsuper();\n\t\tthis.classList.add('tileSelector');\n\t}\n}"]}