PIXI.DisplayObject.prototype.enabled=!0,PIXI.DisplayObject.prototype.enable=function(){this.enabled=!0,this.visible=!0},PIXI.DisplayObject.prototype.disable=function(){this.enabled=!1,this.visible=!1},PIXI.DisplayObject.prototype.update=function(e){},PIXI.DisplayObject.prototype.z=0,PIXI.Container.prototype.update=function(e){this.children.sort((e,t)=>e.z-t.z);for(const t of this.children)t.update(e)},Object.defineProperty(PIXI.DisplayObject.prototype,"scene",{get(){let e=this;for(;!(e instanceof Filament.Scene)&&e.parent;)e=e.parent;return e instanceof Filament.Scene?e:null},set(e){this.scene!==e&&e.addChild(this)}}),Filament.Enum=class{constructor(...e){for(const t of e)this[t]=t}},Filament.SCALE_MODE=new Filament.Enum("NORMAL","NEAREST","HYBRID"),Filament.INDENT_MODE=new Filament.Enum("TAB","SPACE"),Filament.settings={width:320,height:240,tileSize:16,cellSize:24,scaleMode:Filament.SCALE_MODE.HYBRID,maintainAspectRatio:!0,uiRes:1,tabSize:4,indentMode:Filament.INDENT_MODE.TAB},Filament.configure=(e=>{Object.assign(Filament.settings,e)}),Filament.loadSettings=async function(){const e=await(await fetch("game/settings.json")).json();Filament.configure(e)},Filament.truncateNumber=(e=>{if(e<=99999)return e+"";let t=0;for(;e>9999&&t<5;)e/=1e3,++t;return Math.floor(e)+Filament.LARGE_NUMBER_ABBREVIATIONS[t]}),Filament.LARGE_NUMBER_ABBREVIATIONS=["","K","M","B","T","Q"],Filament.sleep=(e=>new Promise(t=>setTimeout(t,e))),Filament.minmax=((e,t,i)=>Math.max(e,Math.min(t,i))),Filament.round=((e,t=0,i="round")=>{const n=Math.pow(10,t);return Math[i](e*n)/n}),Filament.floor=((e,t)=>Filament.round(e,t,"floor")),Filament.ceil=((e,t)=>Filament.round(e,t,"ceil")),Filament.arrayAdd=((e,t,i=e.length)=>e.indexOf(t)>=0||(e.splice(i,0,t),!1)),Filament.arrayRemove=((e,t)=>{const i=e.indexOf(t);return i>=0&&(e.splice(i,1),!0)}),Filament.mixin_object=((e,t)=>{Object.assign(e,t),"function"==typeof t.implement&&t.implement.call(e)}),Filament.mixin=((e,t)=>{if(!(e instanceof Function))return Filament.mixin_object(e,t);e._mixins||(e._mixins=[]),e._mixins.push(t),Object.assign(e.prototype,t),e.prototype.implement=Filament.implement.bind(this)}),Filament.implement=function(e,t){if(e&&t._mixins)for(const i of t._mixins)"function"==typeof i.implement&&i.implement.call(e)},Filament.untag=((e,...t)=>{if(!(e instanceof Array))return e;let i="";for(const n in e)i+=e[n]+(t[n]||"");return i}),Filament.html=((...e)=>{const t=untag(...e),i=document.createElement("div");return i.innerHTML=t,new Filament.NodeList(...i.childNodes)}),Filament.NodeList=class extends Array{mount(e){for(const t of this)e.append(t);return this}elements(){let e=[];for(const t of this)t instanceof Element&&e.push(t);return e}},Filament.createElement=((e,t)=>{let i=e.match(/^[^\s.#[\]]+/);if(!i)throw`Couldn't find tagname in string ${e}`;const n=document.createElement(i[0]);(i=e.match(/#([^\s.#[\]]+)/))&&(n.id=i[1]);let s=/\.([^\s.#[\]]+)/g;for(;i=s.exec(e);)n.classList.add(i[1]);for(s=/\[([^\s.#[\]=]+)=([^\s.#[\]=]+)\]/g;i=s.exec(e);)n.setAttribute(i[1],i[2]);return t&&n.append(t),n.mount=Filament.mountElement,n}),Filament.mountElement=function(e){if(this instanceof Element)return e.append(this),this},Filament.pixiCanvas=document.querySelector("#screen-game canvas"),Filament.parent=Filament.pixiCanvas.parentElement,Filament.ui_container=document.getElementById("ui-container"),Filament.pixi=new PIXI.Application({view:Filament.pixiCanvas,width:Filament.settings.width,height:Filament.settings.height,backgroundColor:136}),Filament.start=async function(){await Filament.loadSettings(),Filament.pixiContext=Filament.pixiCanvas.getContext("2d"),Filament.settings.scaleMode===Filament.SCALE_MODE.HYBRID&&(Filament.hybridCanvas=document.createElement("canvas"),Filament.hybridContext=Filament.hybridCanvas.getContext("2d"),Filament.hybridCanvas.id="hybrid-canvas",Filament.pixiCanvas.parentElement.appendChild(Filament.hybridCanvas),Filament.pixiCanvas.style.opacity=0),document.body.style.setProperty("--uiRes",Filament.settings.uiRes),document.body.style.setProperty("--screen-width",Filament.settings.width),document.body.style.setProperty("--screen-height",Filament.settings.height),Filament.ui_container.style.width=Filament.settings.width*Filament.settings.uiRes+"px",Filament.ui_container.style.height=Filament.settings.height*Filament.settings.uiRes+"px",window.addEventListener("resize",Filament.resize),Filament.resize(),Filament.ticker=Filament.pixi.ticker.add(Filament.update,Filament);for(const e of Object.values(Filament.scenes))e.start()},Filament.update=(()=>{const e=Filament.ticker.elapsedMS/1e3;Filament.scene&&(Filament.scene.update(e),Filament.scene.updateUI(e)),Filament.hybridCanvas&&(Filament.pixi.render(),Filament.hybridContext.drawImage(Filament.pixiCanvas,0,0,Filament.settings.width,Filament.settings.height,0,0,Filament.hybridCanvas.width,Filament.hybridCanvas.height))}),Filament.roundScale=(e=>Math.round(e)||1),Filament.resize=(()=>{let e=Filament.parent.offsetWidth/Filament.settings.width,t=Filament.parent.offsetHeight/Filament.settings.height,i=Math.min(e,t);if(Filament.settings.maintainAspectRatio)e=t=i;else{let e=Filament.parent.offsetWidth/Filament.parent.offsetHeight;e>Filament.settings.width/Filament.settings.height?Filament.pixi.renderer.resize(Filament.settings.height*e,Filament.settings.height):Filament.pixi.renderer.resize(Filament.settings.width,Filament.settings.width/e)}Filament.scaleX=e,Filament.scaleY=t,Filament.scale=i,Filament.pixiCanvas.style.width=Filament.settings.width*e+"px",Filament.pixiCanvas.style.height=Filament.settings.height*t+"px",Filament.hybridCanvas&&(Filament.hybridCanvas.width=Filament.settings.width*Filament.roundScale(e),Filament.hybridCanvas.height=Filament.settings.height*Filament.roundScale(t),Filament.hybridCanvas.style.width=Filament.pixiCanvas.style.width,Filament.hybridCanvas.style.height=Filament.pixiCanvas.style.height,Filament.hybridContext.imageSmoothingEnabled=!1),Filament.ui_container.style.transform="scale("+i/Filament.settings.uiRes+")",Filament.ui_container.style.left=Filament.parent.offsetWidth/2-Filament.ui_container.offsetWidth/2+"px",Filament.ui_container.style.top=Filament.parent.offsetHeight/2-Filament.ui_container.offsetHeight/2+"px"}),Filament.MixinEvents={implement(){this.events={}},getEventList(e,t){return e in this.events||!t||(this.events[e]=[]),this.events[e]},fireEvent(e,t={}){const i=this.getEventList(e,!1);if(i)for(const n in i)t.remove=Filament.EventInterface.removeEvent.bind(this,e,n),"function"==typeof n&&n(t)},addEvent(e,t){return Filament.arrayAdd(this.getEventList(e,!0),t)},removeEvent(e,t){return!!this.getEventList(e,!1)&&Filament.arrayRemove(this.events[e],t)}},Filament.Cache=class{constructor(){this._cache={}}async requestImage(e){return e=`assets/img/${e}`,await this.requestAsset(e,Filament.gameFile(e),e=>(e.texture.baseTexture.scaleMode=Filament.settings.scaleMode===Filament.SCALE_MODE.NORMAL?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST,e.texture))}async requestAudio(e){}requestAsset(e,t,i){return new Promise((n,s)=>{this._cache[e]||(this._cache[e]=new Filament.AssetLoader(e,t,this)),this._cache[e]instanceof Filament.AssetLoader?this._cache[e].addRequest(n,s,i):n(i(this._cache[e]))})}},Filament.cache=new Filament.Cache,Filament.AssetLoader=class extends PIXI.loaders.Loader{constructor(e,t,i){super(),this.add(e,t),this._requests=[],this.load((t,n)=>{const s=n[e];for(const e of this._requests)s.error?e.reject(s.error):e.resolve(e.callback(s));s.error?delete i._cache[e]:i._cache[e]=s})}addRequest(e,t,i){this._requests.push(new Filament.AssetRequest(e,t,i))}},Filament.AssetRequest=class{constructor(e,t,i){this.resolve=e,this.reject=t,this.callback=i}},Filament.UI=class extends PIXI.Container{constructor(){super(),this.ui=document.createElement("div"),this.anchor=new PIXI.ObservablePoint(this._onAnchorUpdate,this),this.setAccessor("id"),this.setAccessor("className"),this.classList=this.ui.classList,this.style=this.ui.style,this.style.position="absolute"}mount(e){return e.addChild(this),this}mountUI(e){return(e instanceof Filament.UI?e.ui:e).append(this.ui),this}setAccessor(e,t=e){Object.defineProperty(this,e,{get(){return this.ui[t]},set(e){this.ui[t]=e}})}enable(){super.enable(),this.setAttribute("data-enabled",!0)}disable(){super.disable(),this.setAttribute("data-enabled",!1)}destroy(){super.destroy(),this.ui.parentNode.removeChild(this.ui)}setAttribute(e,t){t=String(t),this.ui.getAttribute(e)!==t&&this.ui.setAttribute(e,t)}setProperty(e,t){t=String(t),this.ui.style.getPropertyValue(e)!==t&&this.ui.style.setProperty(e,t)}setAttributes(e){for(const t in e)this.setAttribute(t,e[t])}setProperties(e){for(const t in e)this.setProperty(t,e[t])}updateUI(e){this.setAttribute("data-visible",this.worldVisible),!this.ui.parentNode&&this.scene&&this.scene!==this&&this.mountUI(this.scene)}_onAnchorUpdate(){}},Filament.Battler=class{constructor(){this.stats={lethality:0,resilience:0,haste:0,spirit:0,luck:0}}},Filament.keyboard={keys:{},keyEventHandler(e,t){const i=this.getKey(t.key,!1);"function"==typeof i[e]&&i[e]();for(const n of i.keygroups)n.fireEvent(e,t)},addEventHandler(e){this[`${e}Handler`]=this.keyEventHandler.bind(this,e)},getKey(e,t){return e in this.keys||!t||(this.keys[e]=new Filament.Key(e)),this.keys[e]}},Filament.keyboard.addEventHandler("keydown"),Filament.keyboard.addEventHandler("keyup"),Filament.parent.addEventListener("keydown",Filament.keyboard.keydownHandler),Filament.parent.addEventListener("keyup",Filament.keyboard.keyupHandler),Filament.Key=class{constructor(e){this.name=e,this.isDown=!1,this.keygroups=[]}keydown(){this.isDown=!0}keyup(){this.isDown=!1}},Filament.KeyGroup=class{constructor(e,t=[]){this.name=e,this.keys=[];for(const e of t)this.addKey(e);this.implement(Filament.KeyGroup)}addKey(e){const t=Filament.keyboard.getKey(e,!0);Filament.arrayAdd(t.keygroups,this),Filament.arrayAdd(this.keys,t)}removeKey(e){const t=Filament.keyboard.getKey(e,!1);t&&(Filament.arrayRemove(t.keygroups,this),Filament.arrayRemove(this.keys,t))}get isDown(){for(const e in this.keys)if(e.isDown)return!0;return!1}},Filament.mixin(Filament.KeyGroup,Filament.MixinEvents),Filament.Sprite=class extends PIXI.Sprite{constructor(e){super(PIXI.Texture.EMPTY),this.loadTexture(e)}async loadTexture(e){this.texture=await Filament.cache.requestImage(e)}mount(e){return e.addChild(this),this}},Filament.scenes={},Filament.activeScene="home",Object.defineProperty(Filament,"scene",{get:()=>Filament.scenes[Filament.activeScene]||Filament.scenes.home,set(e){const t=Filament.activeScene;if(e in Filament.scenes)Filament.activeScene=e;else for(const t in Filament.scenes)if(e===game.scenes[t]){Filament.activeScene=t;break}if(Filament.activeScene!==t)for(const e of Filament.scenes)Filament.activeScene===e.name?(e.enable(),e.enter()):e.enabled&&(e.disable(),e.leave())}}),Filament.ui_container=document.getElementById("ui-container"),Filament.Scene=class extends Filament.UI{constructor(e){super(),this.mountUI(Filament.ui_container),this.mount(Filament.pixi.stage),Filament.scenes[e]=this,this.id="scene-"+e,this.classList.add("scene"),this.name=e,this.windows=[]}updateUI(e){super.updateUI(e);for(let t=this.windows.length-1;t>=0;--t)this.windows[t].updateUI(e)}start(){}enter(){}leave(){}},Filament.Window=class extends Filament.UI{constructor(){super(),this.classList.add("window"),this.ui_width=20,this.ui_height=20,this.minwidth=20,this.minheight=20,this.maxwidth=Filament.settings.width,this.maxheight=Filament.settings.height,this._hasFrame=!1,this._interactive=!1,this.movable=!1,this.resizable=!1,this.closable=!1,this.edgeSnap=!0,this.content=Filament.createElement("div.content").mount(this.ui),this.handle=Filament.createElement("div.handle").mount(this.ui),this.closeButton=Filament.createElement("div.closeButton","×").mount(this.ui),this.closeButton.addEventListener("click",e=>{this.destroy()}),this.handle.addEventListener("mousedown",e=>{Filament.arrayRemove(this.scene.windows,this),Filament.arrayAdd(this.scene.windows,this),this.dragging=!0}),this.handle.addEventListener("mouseup",e=>{this.dragging=!1}),this.contentObserver=new MutationObserver(()=>{this.resizable&&(this.content.style.width||this.content.style.height)&&(this.content.style.width="",this.content.style.height="",this.resizing=!0)}),this.contentObserver.observe(this.content,{attributes:!0,attributeFilter:["style"]})}mount(e){return super.mount(e),e.scene&&this.mountUI(this.scene),this}mountUI(e){return this.scene&&Filament.arrayRemove(this.scene.windows,this),super.mountUI(e),Filament.arrayAdd(e.windows,this),this}destroy(){this.scene&&Filament.arrayRemove(this.scene.windows,this),super.destroy(...arguments)}get width(){return this.ui_width}set width(e){this.ui_width=e}get height(){return this.ui_height}set height(e){this.ui_height=e}get interactive(){return this._interactive||this.movable||this.resizable||this.closable}set interactive(e){this._interactive=e}get hasFrame(){return this._hasFrame||this.movable||this.resizable||this.closable}set hasFrame(e){this._hasFrame=e}getBoundsUI(){let e={};return e.width=Filament.round(this.width,2),e.height=Filament.round(this.height,2),e.left=Filament.round(this.worldTransform.tx-this.anchor.x*e.width,2),e.top=Filament.round(this.worldTransform.ty-this.anchor.y*e.height,2),e}updateUI(e){super.updateUI(e),this.edgeSnap&&(this.x=Filament.minmax(0,Filament.settings.width-this.width,this.x),this.y=Filament.minmax(0,Filament.settings.height-this.height,this.y)),this.resizable&&(this.width=Filament.minmax(this.minwidth,this.maxwidth,this.width),this.height=Filament.minmax(this.minheight,this.maxheight,this.height));let t=this.getBoundsUI(!0);const i=this.scene.windows.indexOf(this);this.setProperties({"--width":t.width,"--height":t.height,"--x":t.left,"--y":t.top,"--z":this.z+i/1e3,"--alpha":this.worldAlpha}),this.setAttributes({"data-frame":this.hasFrame,"data-interactive":this.interactive,"data-movable":this.movable,"data-resizable":this.resizable,"data-closable":this.closable})}updateDrag(e){this.x+=e.movementX/Filament.scale,this.y+=e.movementY/Filament.scale}updateResize(e){this.width=Math.min(Filament.settings.width-this.x,this.width+e.movementX/Filament.scale),this.height=Math.min(Filament.settings.height-this.y,this.height+e.movementY/Filament.scale),this.resizing=!1}},window.addEventListener("mousemove",e=>{if(Filament.scene)for(const t of Filament.scene.windows)t.dragging&&t.updateDrag(e),t.resizing&&t.updateResize(e)}),window.addEventListener("mouseup",e=>{if(Filament.scene)for(const e of Filament.scene.windows)e.dragging=!1}),new Filament.Scene("home"),Filament.scenes.home.start=function(){this.window=(new Filament.Window).mount(this),this.window.width=100,this.window.height=50,this.window.x=50,this.window.y=25,this.window.resizable=!0,this.window.movable=!0,this.window.closable=!0,this.window.content.append("Hello World"),new Filament.Sprite("ebby.png").mount(this).alpha=.6,new Filament.Sprite("ebby.png").mount(this).x=20},Filament.scenes.home.update=function(){},Filament.MapCellTexture=class extends PIXI.RenderTexture{};
//# sourceMappingURL=engine.js.map
