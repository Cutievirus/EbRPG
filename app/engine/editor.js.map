{"version":3,"sources":["tilesets.js"],"names":["Filament","editorScreen","template","vue","$data","panels","tileset","data","tileset_url","undefined","tileset_width","tileset_height","tools","mode","PLACEMENT_MODE","PEN","img","ERASE","FILL","RECT","CLEARRECT","CLONE","leftTool","editor","rightTool","selectorVisibility","this","clone","methods","[object Object]","event","tool","target","getAttribute","button","ts","settings","tileSize","scale","tileBox","ox","x","Math","floor","offsetX","oy","y","offsetY","width","height","selectTile","mouseIsDown","TileSelector","prototype","dragSelection","call","cache","requestTileset","tilesetId","image","baseTexture","imageUrl","resize","mouseup_event","mouse","addEvent","mouseup","removeEvent","events","tilesetBounds","document","getElementById","getBoundingClientRect","tilesetPanel","style","setProperty"],"mappings":"AAAAA,SAAAC,aAAA,WAAA,CACAC,SAAA,4CAGAF,SAAAG,IAAAC,MAAAC,OAAAC,QAAA,CACAJ,SAAA,o2BAuBAK,KAAA,KAAA,CACAC,iBAAAC,EACAC,cAAA,GACAC,eAAA,GACAC,MAAA,CAAA,CACAC,KAAAb,SAAAc,eAAAC,IACAC,IAAA,2BACA,CACAH,KAAAb,SAAAc,eAAAG,MACAD,IAAA,8BACA,CACAH,KAAAb,SAAAc,eAAAI,KACAF,IAAA,8BACA,CACAH,KAAAb,SAAAc,eAAAK,KACAH,IAAA,4BACA,CACAH,KAAAb,SAAAc,eAAAM,UACAJ,IAAA,iCACA,CACAH,KAAAb,SAAAc,eAAAO,MACAL,IAAA,8BAEAM,SAAAtB,SAAAuB,OAAAD,SACAE,UAAAxB,SAAAuB,OAAAC,UACAD,OAAAvB,SAAAuB,OACAE,yBAAA,OAAAC,KAAAH,OAAAI,MAAA,SAAA,aAEAC,QAAA,CACAC,SAAAC,GACA,MAAAC,EAAAD,EAAAE,OAAAC,aAAA,aACAH,EAAAI,OAAA,GACAR,KAAAF,UAAAO,EACA/B,SAAAuB,OAAAC,UAAAO,IAEAL,KAAAJ,SAAAS,EACA/B,SAAAuB,OAAAD,SAAAS,IAGAF,WAAAC,GACA,MAAAK,EAAAnC,SAAAoC,SAAAC,SAAArC,SAAAsC,MACAC,EAAAvC,SAAAuB,OAAAgB,QACAA,EAAAC,GAAAD,EAAAE,EAAAC,KAAAC,MAAAb,EAAAc,QAAAT,GACAI,EAAAM,GAAAN,EAAAO,EAAAJ,KAAAC,MAAAb,EAAAiB,QAAAZ,GACAI,EAAAS,MAAA,EAAAT,EAAAU,OAAA,EACAjD,SAAAuB,OAAAI,OAAA,GAEAE,UAAAC,GACAJ,KAAAwB,WAAApB,GACAJ,KAAAyB,aAAA,GAEAtB,QAAAC,GACAJ,KAAAyB,aAAA,GAEAtB,UAAAC,GACA,IAAAJ,KAAAyB,YAAA,OACA,MAAAhB,EAAAnC,SAAAoC,SAAAC,SAAArC,SAAAsC,MACAG,EAAAC,KAAAC,MAAAb,EAAAc,QAAAT,GACAW,EAAAJ,KAAAC,MAAAb,EAAAiB,QAAAZ,GACAnC,SAAAoD,aAAAC,UAAAC,cAAAC,KAAA,KAAAvD,SAAAuB,OAAAgB,QAAAE,EAAAK,KAGAjB,gBACA,MAAAvB,QAAAN,SAAAwD,MAAAC,eAAAzD,SAAAuB,OAAAmC,WACA1D,SAAAuB,OAAAjB,QAAAA,EACAoB,KAAAlB,YAAAF,EAAAqD,MAAAC,YAAAC,SACAnC,KAAAhB,cAAAJ,EAAAqD,MAAAC,YAAAZ,MACAtB,KAAAf,eAAAL,EAAAqD,MAAAC,YAAAX,OACAjD,SAAA8D,SACApC,KAAAqC,cAAA/D,SAAAgE,MAAAC,SAAA,UAAAvC,KAAAwC,QAAAxC,OAGAG,gBACA7B,SAAAgE,MAAAG,YAAA,UAAAzC,KAAAqC,iBAIA/D,SAAAoE,OAAAH,SAAA,SAAA,KACA,MAAAI,EAAAC,SAAAC,eAAA,WAAAC,wBACAC,EAAAH,SAAAC,eAAA,iBACAE,EAAAC,MAAA1B,MAAAqB,EAAArB,MAAA,KACAyB,EAAAC,MAAAC,YAAA,cAAAN,EAAA5B,GACAgC,EAAAC,MAAAC,YAAA,cAAAN,EAAAvB,GACA2B,EAAAC,MAAAC,YAAA,kBAAAN,EAAArB,OACAyB,EAAAC,MAAAC,YAAA,mBAAAN,EAAApB","file":"editor.js","sourcesContent":["Filament.editorScreen(\"Tilesets\",{\r\n\ttemplate:`<div id=\"screen-tilesets\">tileset</div>`,\r\n});\r\n\r\nFilament.vue.$data.panels.tileset={\r\n\ttemplate:`<aside id=\"tileset-panel\"\r\n\t:style=\"{'--width':tileset_width,'--height':tileset_height}\">\r\n\t\t<select id=\"tileset-select\">\r\n\t\t</select>\r\n\t\t<div class='editor-button-set'>\r\n\t\t\t<button v-for=\"tool in tools\"\r\n\t\t\t:data-rightTool=\"rightTool===tool.mode\"\r\n\t\t\t:data-leftTool=\"leftTool===tool.mode\"\r\n\t\t\t:data-tool=\"tool.mode\"\r\n\t\t\t@click=\"pickTool\"\r\n\t\t\t@contextmenu.prevent=\"pickTool\"\r\n\t\t\t>\r\n\t\t\t\t<img draggable=false :src=\"tool.img\">\r\n\t\t\t</button>\r\n\t\t</div>\r\n\t\t<div id=\"tileset-container\">\r\n\t\t\t<div id=\"selectedTile\" :style=\"{'--x':editor.tileBox.x,'--y':editor.tileBox.y,'--w':editor.tileBox.width,'--h':editor.tileBox.height, visibility:selectorVisibility}\"></div>\r\n\t\t\t<img draggable=false :src=\"tileset_url\" id=\"tileset\"\r\n\t\t\t@mousedown=\"mousedown\"\r\n\t\t\t@mousemove=\"mousemove\"\r\n\t\t\t>\r\n\t\t</div>\r\n\t</aside>`,\r\n\tdata:()=>({\r\n\t\ttileset_url:undefined,\r\n\t\ttileset_width:96,\r\n\t\ttileset_height:96,\r\n\t\ttools:[{\r\n\t\t\tmode:Filament.PLACEMENT_MODE.PEN,\r\n\t\t\timg:\"engine/img/tool-pen.png\"\r\n\t\t},{\r\n\t\t\tmode:Filament.PLACEMENT_MODE.ERASE,\r\n\t\t\timg:\"engine/img/tool-eraser.png\"\r\n\t\t},{\r\n\t\t\tmode:Filament.PLACEMENT_MODE.FILL,\r\n\t\t\timg:\"engine/img/tool-bucket.png\"\r\n\t\t},{\r\n\t\t\tmode:Filament.PLACEMENT_MODE.RECT,\r\n\t\t\timg:\"engine/img/tool-rect.png\"\r\n\t\t},{\r\n\t\t\tmode:Filament.PLACEMENT_MODE.CLEARRECT,\r\n\t\t\timg:\"engine/img/tool-clearrect.png\"\r\n\t\t},{\r\n\t\t\tmode:Filament.PLACEMENT_MODE.CLONE,\r\n\t\t\timg:\"engine/img/tool-clone.png\"\r\n\t\t}],\r\n\t\tleftTool:Filament.editor.leftTool,\r\n\t\trightTool:Filament.editor.rightTool,\r\n\t\teditor:Filament.editor,\r\n\t\tget selectorVisibility(){ return this.editor.clone?'hidden':'visible'; }\r\n\t}),\r\n\tmethods:{\r\n\t\tpickTool(event){\r\n\t\t\tconst tool = event.target.getAttribute('data-tool');\r\n\t\t\tif(event.button>0){\r\n\t\t\t\tthis.rightTool=tool;\r\n\t\t\t\tFilament.editor.rightTool=tool;\r\n\t\t\t}else{\r\n\t\t\t\tthis.leftTool=tool;\r\n\t\t\t\tFilament.editor.leftTool=tool;\r\n\t\t\t}\r\n\t\t},\r\n\t\tselectTile(event){\r\n\t\t\tconst ts = Filament.settings.tileSize*Filament.scale;\r\n\t\t\tconst tileBox = Filament.editor.tileBox;\r\n\t\t\ttileBox.ox = tileBox.x = Math.floor(event.offsetX/ts);\r\n\t\t\ttileBox.oy = tileBox.y = Math.floor(event.offsetY/ts);\r\n\t\t\ttileBox.width = 1; tileBox.height = 1;\r\n\t\t\tFilament.editor.clone=false;\r\n\t\t},\r\n\t\tmousedown(event){\r\n\t\t\tthis.selectTile(event);\r\n\t\t\tthis.mouseIsDown=true;\r\n\t\t},\r\n\t\tmouseup(event){\r\n\t\t\tthis.mouseIsDown=false;\r\n\t\t},\r\n\t\tmousemove(event){\r\n\t\t\tif(!this.mouseIsDown){ return; }\r\n\t\t\tconst ts = Filament.settings.tileSize*Filament.scale;\r\n\t\t\tconst x = Math.floor(event.offsetX/ts);\r\n\t\t\tconst y = Math.floor(event.offsetY/ts);\r\n\t\t\tFilament.TileSelector.prototype.dragSelection.call(null,Filament.editor.tileBox,x,y);\r\n\t\t}\r\n\t},\r\n\tasync created(){\r\n\t\tconst tileset = await Filament.cache.requestTileset(Filament.editor.tilesetId);\r\n\t\tFilament.editor.tileset = tileset;\r\n\t\tthis.tileset_url=tileset.image.baseTexture.imageUrl;\r\n\t\tthis.tileset_width=tileset.image.baseTexture.width;\r\n\t\tthis.tileset_height=tileset.image.baseTexture.height;\r\n\t\tFilament.resize();\r\n\t\tthis.mouseup_event=Filament.mouse.addEvent('mouseup',this.mouseup,this);\r\n\t},\r\n\r\n\tbeforeDestroy(){\r\n\t\tFilament.mouse.removeEvent('mouseup',this.mouseup_event);\r\n\t}\r\n}\r\n\r\nFilament.events.addEvent('resize',()=>{\r\n\tconst tilesetBounds=document.getElementById(\"tileset\").getBoundingClientRect();\r\n\tconst tilesetPanel = document.getElementById(\"tileset-panel\");\r\n\ttilesetPanel.style.width=tilesetBounds.width+'px';\r\n\ttilesetPanel.style.setProperty('--tileset-x',tilesetBounds.x);\r\n\ttilesetPanel.style.setProperty('--tileset-y',tilesetBounds.y);\r\n\ttilesetPanel.style.setProperty('--tileset-width',tilesetBounds.width);\r\n\ttilesetPanel.style.setProperty('--tileset-height',tilesetBounds.height);\r\n});"]}