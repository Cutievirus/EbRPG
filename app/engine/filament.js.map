{"version":3,"sources":["0_filament.js","lzma.js","vue.js"],"names":["window","Filament","gameDir","loadScript","sources","Promise","resolve","Array","script","document","createElement","src","shift","length","onload","then","head","append","loadStyle","source","stylesheet","setAttribute","path","parts","gameFile","filename","loadGame","scripts","electron","vue","$data","editor","push","remote","ipcRenderer","ipc","require","mainProcess","getCurrentWindow","dialog","err","enabled","Boolean","lzma","LZMA","compress_promise","data","mode","progress","reject","compress","result","error","decompress_promise","decompress","saveGameData","async","savedata","loadGameData","saveFile","text","json","JSON","stringify","loadFile","saveData","key","map","n","String","fromCodePoint","join","localStorage","set","settings","slug","loadData","get","Int8Array","prototype","call","codePointAt","parse","Vue","el","activeScreen","screens","panels","editorScreen","name","component","v","screen","id","template","[object Object]"],"mappings":"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","file":"filament.js","sourcesContent":["if(!window.Filament){ window.Filament={\r\n\tgameDir: \"./game/\"\r\n};}\r\n\r\nFilament.loadScript=sources=>{\r\n\treturn new Promise(resolve=>{\r\n\t\tif( !(sources instanceof Array) ){ sources = [sources]; }\r\n\t\tconst script = document.createElement(\"script\");\r\n\t\tscript.src = sources.shift();\r\n\t\tif( sources.length ) {\r\n\t\t\tscript.onload =()=>Filament.loadScript(sources).then(resolve);\r\n\t\t}else{\r\n\t\t\tscript.onload = resolve;\r\n\t\t}\r\n\t\tdocument.head.append(script);\r\n\t});\r\n};\r\n\r\nFilament.loadStyle=source=>{\r\n\tconst stylesheet = document.createElement(\"link\");\r\n\tstylesheet.setAttribute('rel','stylesheet');\r\n\tstylesheet.setAttribute('type','text/css');\r\n\tstylesheet.setAttribute('href',source);\r\n\tdocument.head.append(stylesheet);\r\n}\r\n\r\nFilament.path=(...parts)=>{\r\n\tlet path='';\r\n\twhile(parts.length){\r\n\t\tif(!parts[0]){ parts.shift();continue; }\r\n\t\tpath+=`${!path||path[path.length-1]==='/'?'':'/'}${parts.shift()}`;\r\n\t}\r\n\treturn path;\r\n};\r\nFilament.gameFile=filename=>Filament.path(Filament.gameDir,filename);\r\n\r\nFilament.loadGame=()=>{\r\n\tconst scripts = [\"engine/engine.js\"];\r\n\tif(Filament.electron){\r\n\t\tFilament.vue.$data.editor=true;\r\n\t\tscripts.push(\"engine/editor.js\");\r\n\t}\r\n\tscripts.push(Filament.gameFile(\"game.js\"));\r\n\tFilament.loadScript(scripts);\r\n};\r\n\r\nFilament.loadStyle(Filament.gameFile('style.css'));\r\n\r\ntry{\r\n\tconst { remote, ipcRenderer:ipc } = require('electron');\r\n\tFilament.electron={\r\n\t\tremote:remote,\r\n\t\tipc:ipc,\r\n\t\tmainProcess:remote.require('./main.js'),\r\n\t\twindow:remote.getCurrentWindow(),\r\n\t\tdialog:remote.dialog\r\n\t}\r\n}catch(err){ /* continue without electron */ }\r\n\r\nFilament.editor={enabled:Boolean(Filament.electron)};","Filament.lzma = new LZMA(\"./lib/lzma_worker-min.js\");\r\n\r\nFilament.lzma.compress_promise=(data,mode=1,progress=undefined)=>new Promise((resolve,reject)=>{\r\n\tFilament.lzma.compress(data,mode,(result,error)=>{\r\n\t\tif(error){\r\n\t\t\treject(error);\r\n\t\t}else{\r\n\t\t\tresolve(result);\r\n\t\t}\r\n\t},progress);\r\n});\r\n\r\nFilament.lzma.decompress_promise=(data,progress)=>new Promise((resolve,reject)=>{\r\n\tFilament.lzma.decompress(data,(result,error)=>{\r\n\t\tif(error){\r\n\t\t\treject(error);\r\n\t\t}else{\r\n\t\t\tresolve(result);\r\n\t\t}\r\n\t},progress);\r\n});\r\n\r\nFilament.saveGameData = async function(){\r\n\tawait Filament.lzma.compress_promise(Filament.savedata,1);\r\n}\r\nFilament.loadGameData = async function(){\r\n\tawait Filament.lzma.decompress_promise(\"TODO\");\r\n}\r\n\r\nFilament.saveFile = async function(text,path,json=true){\r\n\tpath = Filament.gameFile(path);\r\n\tif(json){ text = JSON.stringify(text); }\r\n\tlet data = await Filament.lzma.compress_promise(text,1);\r\n\t// TODO: Save\r\n}\r\nFilament.loadFile = async function(path,json=true){\r\n\tpath = Filament.gameFile(path);\r\n\t// TODO\r\n}\r\n\r\nFilament.saveData = async function(text,key,json=true){\r\n\tif(json){ text = JSON.stringify(text); }\r\n\tlet data = await Filament.lzma.compress_promise(text,1);\r\n\tdata = data.map(n=>String.fromCodePoint((n<0?n+256:n)+32)).join('');\r\n\twindow.localStorage.set(`${Filament.settings.slug}-${key}`,data);\r\n}\r\nFilament.loadData = async function(key,json=true){\r\n\tkey = `${Filament.settings.slug}-${key}`;\r\n\tlet data = window.localStorage.get(key);\r\n\tdata = new Int8Array(Array.prototype.map.call(data,n=>n.codePointAt(0)-32));\r\n\tdata = await Filament.lzma.decompress_promise(data);\r\n\tif(json){ data=JSON.parse(data); }\r\n\treturn data;\r\n}","// register components\r\n\r\n// setup vue\r\n\r\nFilament.vue = new Vue({ \r\n\tel:'#wrapper',\r\n\tdata:{\r\n\t\tactiveScreen:null,\r\n\t\tscreens:[],\r\n\t\teditor:false,\r\n\t\tpanels:{},\r\n\t}\r\n});\r\n\r\n// add screens\r\n\r\nFilament.editorScreen=(name,component)=>{\r\n\tconst v = Filament.vue.$data;\r\n\tconst screen = {\r\n\t\tid: v.screens.length,\r\n\t\tname: name,\r\n\t\tcomponent: component,\r\n\t};\r\n\tif(v.screens.length===0){ v.activeScreen = screen; }\r\n\tv.screens.push(screen);\r\n};\r\n\r\nFilament.editorScreen(\"Map\",{\r\n\ttemplate:`<div id=\"screen-game\" tabindex=\"0\">\r\n\t\t<canvas id=\"pixi-canvas\"></canvas>\r\n\t\t<div id=\"ui-container\"></div>\r\n\t</div>`,\r\n\tmounted(){\r\n\t\t// run game script\r\n\t\tFilament.loadGame();\r\n\t},\r\n});"]}